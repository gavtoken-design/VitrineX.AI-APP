import{a as I,c as w}from"./constants-BAIO8zZj.js";import{K as p}from"./index-CYQb2vCA.js";import{p as y}from"./api-CfjT-eUR.js";const $=async(n,a)=>{var r,i,c;const e=(a==null?void 0:a.model)||I,t={aspectRatio:a==null?void 0:a.aspectRatio};e===w&&(a!=null&&a.imageSize)&&(t.imageSize=a.imageSize);try{const s=await y("generate-image","POST",{prompt:n,model:e,imageConfig:t,options:{}});return{imageUrl:`data:${s.mimeType};base64,${s.base64Image}`}}catch(s){console.warn("Backend proxy failed for generateImage, falling back to client-side SDK.",s);const d=await(await p()).models.generateContent({model:e,contents:{parts:[{text:n}]},config:{imageConfig:t}});let o="";for(const l of((c=(i=(r=d.candidates)==null?void 0:r[0])==null?void 0:i.content)==null?void 0:c.parts)||[])if(l.inlineData){o=`data:${l.inlineData.mimeType};base64,${l.inlineData.data}`;break}return o?{imageUrl:o}:{text:d.text||"Imagem gerada, mas formato não reconhecido no fallback."}}},h=async(n,a,e,t=I)=>{var r,i,c,s,x,d,o,l,u;try{const m=await y("call-gemini","POST",{model:t,contents:[{role:"user",parts:[{inlineData:{data:a,mimeType:e}},{text:n}]}]}),g=(x=(s=(c=(i=(r=m.response)==null?void 0:r.candidates)==null?void 0:i[0])==null?void 0:c.content)==null?void 0:s.parts)==null?void 0:x.find(f=>f.inlineData);return g?{imageUrl:`data:${g.inlineData.mimeType};base64,${g.inlineData.data}`}:{text:((d=m.response)==null?void 0:d.text)||"Nenhuma edição retornada."}}catch(m){console.warn("Backend proxy failed for editImage, falling back to client-side SDK.",m);const f=await(await p()).models.generateContent({model:t,contents:{parts:[{inlineData:{data:a,mimeType:e}},{text:n}]}});for(const D of((u=(l=(o=f.candidates)==null?void 0:o[0])==null?void 0:l.content)==null?void 0:u.parts)||[])if(D.inlineData)return{imageUrl:`data:${D.inlineData.mimeType};base64,${D.inlineData.data}`};return{text:f.text||"Nenhuma edição retornada no fallback."}}},E=async(n,a,e,t=w)=>{var r;try{return((r=(await y("call-gemini","POST",{model:t,contents:[{role:"user",parts:[{inlineData:{data:n,mimeType:a}},{text:e}]}]})).response)==null?void 0:r.text)||"Sem análise."}catch(i){return console.warn("Backend proxy failed for analyzeImage, falling back to client-side SDK.",i),(await(await p()).models.generateContent({model:t,contents:{parts:[{inlineData:{data:n,mimeType:a}},{text:e}]}})).text||"Sem análise no fallback."}};export{E as a,h as e,$ as g};
