import{h as o,o as M,k as e,B as b,L as C}from"./index-CYQb2vCA.js";import{T as R}from"./Textarea-NzWuWU9_.js";import{I as G}from"./Input-CqKjf13d.js";import{M as U,S as E}from"./MediaActionsToolbar-Bb4kA36I.js";import{P as x,G as F,a as T}from"./constants-BAIO8zZj.js";import{g as H}from"./text-BDHlRMbB.js";import{g as k}from"./image-DLvXVN1U.js";import{s as J}from"./firestore-0QyyegWm.js";import"./useMediaActions-CdIS-dx2.js";import"./db-CogJ5b11.js";import"./api-CfjT-eUR.js";const te=()=>{const[r,_]=o.useState(""),[t,N]=o.useState(null),[d,y]=o.useState(x),[l,c]=o.useState(!1),[w,g]=o.useState(!1),[u,S]=o.useState(""),[j,I]=o.useState(""),{addToast:s}=M(),f="mock-user-123",h=o.useCallback(async(a=!1)=>{if(!r.trim()){s({type:"warning",title:"Atenção",message:"Por favor, insira um prompt para gerar conteúdo."});return}c(!0),g(!0),N(null),y(x),S(""),I("");try{let n=`Generate a compelling social media post for: "${r}".`;a?n=`Generate 7 unique social media post ideas (including text and image descriptions for each) for a weekly content plan based on: "${r}". Format as a JSON array of objects with 'text' and 'image_description' keys.`:n=`Generate a compelling social media post (text only) for: "${r}". Include relevant hashtags.`;const i=await H(n,{model:F});let m="",p="",v=[];if(a)try{v=JSON.parse(i),v.length>0?(m=v[0].text,p=v[0].image_description||r):(m="No weekly posts generated in JSON format. Here's the raw response: "+i,p=r)}catch(D){console.warn("Failed to parse weekly posts as JSON, using raw text.",D),m=i,p=r}else m=i,p=`An image illustrating the post content: "${m.substring(0,100)}..."`;c(!1);const P=await k(p,{model:T});y(P.imageUrl||x),g(!1);const B={id:`post-${Date.now()}`,userId:f,content_text:m,image_url:P.imageUrl||void 0,createdAt:new Date().toISOString()};N(B),s({type:"success",title:"Conteúdo Gerado",message:"Texto e imagem foram gerados com sucesso."})}catch(n){console.error("Error generating content:",n),s({type:"error",title:"Erro na Geração",message:`Falha: ${n instanceof Error?n.message:String(n)}`}),c(!1),g(!1)}},[r,f,s]),L=o.useCallback(()=>h(!1),[h]),A=o.useCallback(()=>h(!0),[h]),O=o.useCallback(async()=>{if(!t){s({type:"error",message:"Por favor gere um post primeiro."});return}g(!0);try{const a=`An alternative image for: "${t.content_text.substring(0,100)}..."`,n=await k(a,{model:T});if(y(n.imageUrl||x),t){const i={...t,image_url:n.imageUrl||void 0};N(i)}s({type:"success",message:"Imagem regenerada com sucesso."})}catch(a){console.error("Error regenerating image:",a),s({type:"error",title:"Erro",message:"Falha ao regenerar imagem."})}finally{g(!1)}},[t,s]),$=o.useCallback(async()=>{if(!t){s({type:"warning",message:"Nenhum post para salvar."});return}c(!0);try{const a=await J(t);s({type:"success",title:"Salvo na Biblioteca",message:`Post "${a.content_text.substring(0,20)}..." salvo com sucesso!`})}catch(a){console.error("Error saving post:",a),s({type:"error",title:"Erro ao Salvar",message:"Não foi possível salvar o post na biblioteca."})}finally{c(!1)}},[t,s]);return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-textdark mb-8",children:"Content Generator"}),e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Gerar Novo Conteúdo"}),e.jsx(R,{id:"contentPrompt",label:"Descreva o conteúdo que você deseja gerar:",value:r,onChange:a=>_(a.target.value),rows:6,placeholder:"Ex: 'Um post sobre os benefícios da meditação para o bem-estar mental', ou 'Ideias para 7 posts semanais sobre dicas de produtividade no trabalho.'"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsx(b,{onClick:L,isLoading:l&&!t,variant:"primary",className:"w-full sm:w-auto",children:l&&!t?"Gerando Post...":"Gerar 1 Post"}),e.jsx(b,{onClick:A,isLoading:l&&!t&&r.includes("semanal"),variant:"secondary",className:"w-full sm:w-auto",children:l&&!t&&r.includes("semanal")?"Gerando Semana...":"Gerar Semana"})]})]}),t&&e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 animate-slide-in-from-bottom duration-500",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Conteúdo Gerado"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Texto do Post"}),l&&!t.content_text?e.jsx(C,{}):e.jsx("div",{className:"prose max-w-none text-textlight leading-relaxed bg-darkbg p-4 rounded-md h-full min-h-[150px]",style:{whiteSpace:"pre-wrap"},children:t.content_text})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Imagem do Post"}),w?e.jsx("div",{className:"flex items-center justify-center h-48 bg-gray-900 rounded-md",children:e.jsx(C,{})}):e.jsx("img",{src:d,alt:"Generated content visual",className:"w-full h-48 object-contain rounded-md border border-gray-700 mb-4"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(b,{onClick:O,isLoading:w,variant:"outline",className:"w-full sm:w-auto",children:w?"Regenerando...":"Regenerar Imagem"}),e.jsx(U,{mediaUrl:d,fileName:"vitrinex-post.png",shareTitle:"Confira este post!",shareText:t.content_text})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-800",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-4",children:"Salvar na Biblioteca"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(G,{id:"saveName",label:"Nome do Item",value:u,onChange:a=>S(a.target.value),placeholder:"Ex: Post Campanha Verão"}),e.jsx(G,{id:"saveTags",label:"Tags (separadas por vírgula)",value:j,onChange:a=>I(a.target.value),placeholder:"Ex: instagram, verão, promoção"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(b,{onClick:$,variant:"primary",isLoading:l,disabled:!t,className:"w-full sm:w-auto",children:l?"Salvando Post Completo...":"Salvar Post Completo"}),e.jsx(E,{content:d,type:"image",userId:f,initialName:u||"Imagem Gerada",tags:j.split(",").map(a=>a.trim()).filter(Boolean),label:"Salvar Apenas Imagem",variant:"secondary",disabled:!d||d===x,className:"w-full sm:w-auto"}),e.jsx(E,{content:t.content_text,type:"text",userId:f,initialName:u?`${u} (Texto)`:"Texto do Post",tags:j.split(",").map(a=>a.trim()).filter(Boolean),label:"Salvar Apenas Texto",variant:"outline",className:"w-full sm:w-auto"})]})]})]})]})};export{te as default};
