import{h as r,l as z,o as D,k as e,M as U,B as i,L as F,N as K,F as M,G as W,J as P,w as V,O as H,H as J}from"./index-CYQb2vCA.js";import{e as O,d as X,f as Q}from"./db-CogJ5b11.js";import{a as Y,u as Z}from"./useMediaActions-CdIS-dx2.js";import{u as ee,c as ae}from"./knowledge-Ccx_Gmnw.js";import{I as se}from"./Input-CqKjf13d.js";import"./constants-BAIO8zZj.js";import"./api-CfjT-eUR.js";import"./text-BDHlRMbB.js";const me=()=>{const[f,x]=r.useState([]),[I,b]=r.useState(!0),[g,y]=r.useState(""),[c,v]=r.useState("all"),[j,w]=r.useState(!1),[A,N]=r.useState(!1),[l,L]=r.useState(localStorage.getItem("vitrinex_kb_name")),{navigateTo:h}=z(),{addToast:t}=D(),{handleDownload:T,handleShare:C,isProcessing:S}=Y(),d="mock-user-123",u=r.useCallback(async a=>{b(!0);try{const s=await O(d,a);x(s)}catch(s){console.error("Failed to fetch library items:",s),t({type:"error",title:"Erro",message:"Falha ao carregar biblioteca."})}finally{b(!1)}},[d,t]);r.useEffect(()=>{u()},[]);const q=async()=>{N(!0);try{const a=await ae(`VitrineX KB - ${new Date().toLocaleDateString()}`);a&&a.storeName&&(localStorage.setItem("vitrinex_kb_name",a.storeName),L(a.storeName),t({type:"success",title:"Base Criada",message:"Base de Conhecimento criada! Você já pode indexar arquivos."}))}catch(a){console.error(a),t({type:"error",title:"Erro",message:"Erro ao criar base de conhecimento. Verifique sua chave API."})}finally{N(!1)}},$=r.useCallback(async a=>{var m;const s=(m=a.target.files)==null?void 0:m[0];if(s){w(!0);try{let o;s.type.startsWith("image")?o="image":s.type.startsWith("video")?o="video":s.type.startsWith("audio")?o="audio":o="text";const n=await Z(s,d,o);if(l&&(o==="text"||s.type==="application/pdf"||s.type.startsWith("application/vnd.openxmlformats"))&&window.confirm(`Deseja indexar "${s.name}" na sua Base de Conhecimento para pesquisa?`))try{await ee(s,{}),t({type:"success",title:"Indexado",message:"Arquivo indexado na IA com sucesso!"}),n.tags.push("indexed")}catch(p){console.error("Indexing failed",p),t({type:"warning",title:"Parcial",message:"Upload concluído, mas falha ao indexar na IA."})}await X(n),x(p=>[n,...p]),t({type:"success",message:"Arquivo enviado com sucesso!"})}catch(o){const n=`Falha: ${o instanceof Error?o.message:String(o)}`;t({type:"error",title:"Erro no Upload",message:n})}finally{w(!1),a.target.value=""}}},[d,l,t]),B=r.useCallback(async a=>{if(window.confirm("Tem certeza que deseja excluir este item?"))try{await Q(a),x(s=>s.filter(m=>m.id!==a)),t({type:"success",message:"Item excluído."})}catch(s){console.error("Error deleting item:",s),t({type:"error",message:"Falha ao excluir item."})}},[t]),E=r.useCallback(a=>{if(a.type!=="image"&&a.type!=="video"){t({type:"warning",message:"Apenas imagens e vídeos podem ser compartilhados."});return}C(a.file_url,a.name,`Confira este arquivo da minha biblioteca: ${a.name}`)},[t,C]);r.useCallback(a=>{h("SmartScheduler"),t({type:"info",message:`Item "${a.name}" pronto para agendar.`})},[h,t]);const R=Array.from(new Set(f.flatMap(a=>a.tags))),k=f.filter(a=>a.name.toLowerCase().includes(g.toLowerCase())).filter(a=>c==="all"||a.tags.includes(c)),_=g.trim()!==""||c!=="all",G=r.useCallback(()=>{y(""),v("all"),u()},[u]);return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-textdark mb-8",children:"Biblioteca de Conteúdo"}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-8 flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[e.jsx(U,{className:"w-6 h-6 text-accent"})," Base de Conhecimento (IA)"]}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:l?`Conectado a: ${l}. Arquivos enviados podem ser pesquisados pelo Chatbot.`:"Crie um repositório para indexar seus arquivos e permitir que a IA responda com base neles."})]}),e.jsx("div",{children:l?e.jsx("span",{className:"text-xs font-mono bg-black/30 px-3 py-1 rounded text-accent border border-accent/20",children:"Status: Ativo"}):e.jsx(i,{onClick:q,isLoading:A,variant:"secondary",children:"Criar Base de Conhecimento"})})]}),e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Gerenciar Conteúdo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(se,{id:"searchContent",type:"text",placeholder:"Buscar por nome...",value:g,onChange:a=>y(a.target.value),className:"col-span-1 md:col-span-2"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tagFilter",className:"sr-only",children:"Filtrar por Tag"}),e.jsxs("select",{id:"tagFilter",value:c,onChange:a=>v(a.target.value),className:"block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm bg-lightbg text-textdark focus:outline-none focus:ring-2 focus:ring-neonGreen focus:border-neonGreen focus:ring-offset-2 focus:ring-offset-lightbg sm:text-sm",children:[e.jsx("option",{value:"all",children:"Todas as Tags"}),R.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("label",{htmlFor:"file-upload-input",className:`cursor-pointer inline-flex items-center justify-center px-5 py-2 text-base font-semibold rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition duration-200 ease-in-out w-full sm:w-auto
              ${j?"opacity-60 cursor-not-allowed bg-accent text-darkbg":"bg-accent text-darkbg shadow-lg shadow-accent/50 hover:bg-neonGreen/80 focus:ring-neonGreen focus:ring-offset-lightbg"}`,children:[j?e.jsx(F,{}):"Enviar Arquivo",e.jsx("input",{id:"file-upload-input",type:"file",onChange:$,className:"hidden"})]}),_&&e.jsx(i,{variant:"primary",onClick:G,className:"w-full sm:w-auto",children:"Limpar Filtros"})]})]}),I?e.jsxs("div",{className:"flex justify-center items-center h-48",children:[e.jsx(F,{}),e.jsx("p",{className:"ml-2 text-textlight",children:"Carregando biblioteca..."})]}):k.length===0?e.jsx("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 text-center text-textlight",children:"Nenhum item encontrado na biblioteca."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6",children:k.map(a=>e.jsxs("div",{className:"bg-lightbg rounded-lg shadow-sm border border-gray-800 overflow-hidden group",children:[e.jsxs("div",{className:"relative h-48 bg-gray-900 flex items-center justify-center overflow-hidden",children:[a.type==="image"||a.type==="video"?e.jsx("img",{src:a.thumbnail_url||a.file_url||"https://picsum.photos/200/150",alt:a.name,className:"w-full h-full object-cover"}):a.type==="audio"?e.jsxs("div",{className:"text-gray-500 text-center p-4",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm text-textlight",children:"Arquivo de Áudio"})]}):e.jsxs("div",{className:"text-gray-500 text-center p-4",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm text-textlight",children:"Arquivo de Texto"})]}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 gap-2",children:[e.jsx(i,{onClick:()=>T(a.file_url,a.name),variant:"ghost",size:"sm",className:"text-white hover:bg-primary/20",title:"Baixar",disabled:S,children:e.jsx(W,{className:"w-5 h-5 text-accent"})}),e.jsx(i,{onClick:()=>E(a),variant:"ghost",size:"sm",className:"text-white hover:bg-primary/20",title:"Compartilhar",disabled:S,children:e.jsx(P,{className:"w-5 h-5 text-accent"})}),e.jsx(i,{onClick:()=>h("SmartScheduler"),variant:"ghost",size:"sm",className:"text-white hover:bg-primary/20",title:"Usar no Calendário",children:e.jsx(V,{className:"w-5 h-5 text-accent"})}),e.jsx(i,{onClick:()=>B(a.id),variant:"danger",size:"sm",className:"text-white hover:bg-red-700",title:"Excluir",children:e.jsx(H,{className:"w-5 h-5 text-red-400"})})]})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-semibold text-textdark truncate flex-1",children:a.name}),a.tags.includes("indexed")&&e.jsx(J,{className:"w-4 h-4 text-accent",title:"Indexado na IA"})]}),e.jsxs("p",{className:"text-sm text-textmuted mt-1",children:["Tipo: ",a.type]}),a.tags.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.tags.map(s=>e.jsx("span",{className:"bg-darkbg text-textlight text-xs px-2 py-1 rounded-full",children:s},s))})]})]},a.id))})]})};export{me as default};
