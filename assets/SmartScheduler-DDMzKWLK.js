import{h as r,o as z,k as e,B as S,L as H,O,P as _,Q as q,I as Q}from"./index-CYQb2vCA.js";import{I as F}from"./Input-CqKjf13d.js";import{b as J,e as K,h as $,i as U}from"./db-CogJ5b11.js";import"./constants-BAIO8zZj.js";const Z=()=>{var E,P;const[N,x]=r.useState([]),[h,A]=r.useState([]),[L,v]=r.useState(!0),[k,d]=r.useState(null),[l,g]=r.useState(""),[m,p]=r.useState(""),[u,f]=r.useState(""),[n,C]=r.useState(""),[b,T]=r.useState("post"),[D,I]=r.useState(!1),i="mock-user-123",{addToast:o}=z(),G=r.useCallback(async()=>{v(!0),d(null);try{const t=await J(i),s=await K(i);x(t.sort((a,c)=>new Date(a.datetime).getTime()-new Date(c.datetime).getTime())),A(s),s.length>0&&!n&&(C(s[0].id),T(s[0].type))}catch(t){const s=`Falha ao carregar dados do agendador: ${t instanceof Error?t.message:String(t)}`;d(s),o({type:"error",title:"Erro de Carregamento",message:s})}finally{v(!1)}},[i,n,o]);r.useEffect(()=>{G()},[]);const B=r.useCallback(async()=>{if(!l||!m||!u||!n){o({type:"warning",message:"Por favor, preencha todos os campos para agendar."});return}I(!0),d(null);try{const t=`${m}T${u}:00`,s={id:`schedule-${Date.now()}`,userId:i,datetime:new Date(t).toISOString(),platform:l,contentId:n,contentType:b,status:"scheduled"},a=await $(s);x(c=>[...c,a].sort((j,y)=>new Date(j.datetime).getTime()-new Date(y.datetime).getTime())),g(""),p(""),f(""),o({type:"success",message:"Conteúdo agendado com sucesso!"})}catch(t){const s=`Falha ao agendar conteúdo: ${t instanceof Error?t.message:String(t)}`;d(s),o({type:"error",title:"Erro",message:s})}finally{I(!1)}},[l,m,u,n,b,i,o]),M=r.useCallback(async t=>{if(window.confirm("Tem certeza que deseja cancelar este agendamento?")){d(null);try{await U(t),x(s=>s.filter(a=>a.id!==t)),o({type:"success",message:"Agendamento cancelado."})}catch(s){const a=`Falha ao cancelar agendamento: ${s instanceof Error?s.message:String(s)}`;d(a),o({type:"error",title:"Erro",message:a})}}},[o]),w=r.useCallback(t=>h.find(s=>s.id===t),[h]),R=t=>{switch(t){case"published":return e.jsx(Q,{className:"w-5 h-5 text-accent"});case"failed":return e.jsx(q,{className:"w-5 h-5 text-red-500"});case"scheduled":default:return e.jsx(_,{className:"w-5 h-5 text-primary"})}};return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-textdark mb-8",children:"Agendador Inteligente (Autopost)"}),k&&e.jsxs("div",{className:"bg-red-900 border border-red-600 text-red-300 px-4 py-3 rounded relative mb-8",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Erro!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",k]})]}),e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Agendar Nova Publicação"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contentSelect",className:"block text-sm font-medium text-textlight mb-1",children:"Conteúdo para Publicar:"}),e.jsxs("select",{id:"contentSelect",value:n,onChange:t=>{C(t.target.value);const s=h.find(a=>a.id===t.target.value);s&&T(s.type)},className:"block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm bg-lightbg text-textdark focus:outline-none focus:ring-2 focus:ring-neonGreen focus:border-neonGreen focus:ring-offset-2 focus:ring-offset-lightbg sm:text-sm mb-2",children:[e.jsx("option",{value:"",children:"Selecione um item da Biblioteca"}),h.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.type,")"]},t.id))]}),n&&((E=w(n))==null?void 0:E.thumbnail_url)&&e.jsx("img",{src:((P=w(n))==null?void 0:P.thumbnail_url)||"https://picsum.photos/100/100",alt:"Selected content thumbnail",className:"w-24 h-24 object-cover rounded-md mt-2 border border-gray-700"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"platformSelect",className:"block text-sm font-medium text-textlight mb-1",children:"Plataforma:"}),e.jsxs("select",{id:"platformSelect",value:l,onChange:t=>g(t.target.value),className:"block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm bg-lightbg text-textdark focus:outline-none focus:ring-2 focus:ring-neonGreen focus:border-neonGreen focus:ring-offset-2 focus:ring-offset-lightbg sm:text-sm",children:[e.jsx("option",{value:"",children:"Selecione uma plataforma"}),e.jsx("option",{value:"Instagram",children:"Instagram"}),e.jsx("option",{value:"Facebook",children:"Facebook"}),e.jsx("option",{value:"TikTok",children:"TikTok"}),e.jsx("option",{value:"Pinterest",children:"Pinterest"}),e.jsx("option",{value:"GoogleMyBusiness",children:"Google My Business"})]})]}),e.jsx(F,{id:"scheduleDate",label:"Data:",type:"date",value:m,onChange:t=>p(t.target.value)}),e.jsx(F,{id:"scheduleTime",label:"Hora:",type:"time",value:u,onChange:t=>f(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(S,{onClick:B,isLoading:D,variant:"primary",className:"w-full md:w-auto",disabled:!n||!l||!m||!u,children:D?"Agendando...":"Agendar"}),e.jsx(S,{onClick:()=>{if(!l||!n){o({type:"warning",message:"Selecione conteúdo e plataforma para publicar."});return}const t=new Date,s={id:`schedule-${Date.now()}`,userId:i,datetime:t.toISOString(),platform:l,contentId:n,contentType:b,status:"published"};$(s).then(a=>{x(c=>[...c,a].sort((j,y)=>new Date(j.datetime).getTime()-new Date(y.datetime).getTime())),o({type:"success",message:"Conteúdo publicado com sucesso!"}),g(""),p(""),f("")}).catch(a=>{o({type:"error",message:"Erro ao publicar."}),console.error(a)})},variant:"secondary",className:"w-full md:w-auto",disabled:!n||!l,children:"Publicar Agora"})]})]}),e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Próximos Agendamentos e Histórico"}),L?e.jsxs("div",{className:"flex justify-center items-center h-48",children:[e.jsx(H,{}),e.jsx("p",{className:"ml-2 text-textlight",children:"Carregando agendamentos..."})]}):N.length===0?e.jsx("div",{className:"text-center text-textlight p-4",children:"Nenhum agendamento encontrado."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-darkbg",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-textmuted uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-textmuted uppercase tracking-wider",children:"Data/Hora"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-textmuted uppercase tracking-wider",children:"Conteúdo"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-textmuted uppercase tracking-wider",children:"Plataforma"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-textmuted uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-lightbg divide-y divide-gray-700",children:N.map(t=>{const s=w(t.contentId),a=new Date(t.datetime),c=a<new Date;return e.jsxs("tr",{className:c?"bg-darkbg text-textmuted":"text-textlight",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center",children:[R(t.status),e.jsx("span",{className:"ml-2 capitalize",children:t.status})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[a.toLocaleDateString()," ",a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:s?s.name:"Conteúdo não encontrado"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t.platform}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:!c&&e.jsxs(S,{onClick:()=>M(t.id),variant:"danger",size:"sm",className:"mr-2",children:[e.jsx(O,{className:"w-4 h-4 text-red-300"})," Cancelar"]})})]},t.id)})})]})})]})]})};export{Z as default};
