import{h as r,l as J,o as X,m as Y,k as e,D as ee,L as se,B as p,E as ae}from"./index-CYQb2vCA.js";import{I as re}from"./Input-CqKjf13d.js";import{G as te}from"./constants-BAIO8zZj.js";import{s as ne,g as oe}from"./text-BDHlRMbB.js";import{s as ie}from"./db-CogJ5b11.js";import"./api-CfjT-eUR.js";function le({title:l,titleId:x,...n},h){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":x},n),l?r.createElement("title",{id:x},l):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"}))}const R=r.forwardRef(le),he=()=>{const[l,x]=r.useState(""),[n,h]=r.useState(""),[S,w]=r.useState([]),[T,I]=r.useState(!1),[L,N]=r.useState(null),[ce,D]=r.useState(null),[m,b]=r.useState("pending"),[E,k]=r.useState({}),[W,$]=r.useState(null),{navigateTo:f}=J(),{addToast:o}=X(),{language:y}=Y(),G="mock-user-123",C=r.useCallback(()=>{b("pending"),navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{D({latitude:s.coords.latitude,longitude:s.coords.longitude}),b("success")},s=>{console.warn("Geolocation access denied or failed:",s),b("denied")},{enableHighAccuracy:!1,timeout:5e3,maximumAge:0}):b("denied")},[]);r.useEffect(()=>{C()},[C]);const _=r.useCallback(async()=>{if(!l.trim()){o({type:"warning",message:"Por favor, insira um termo de busca para tendências."});return}I(!0),N(null),w([]),k({});try{let s=l;n.trim()&&(s+=` em ${n}`);const i=(await ne(s,y)).map(c=>({...c,userId:G}));w(i);for(const c of i)await ie(c);o({type:"success",message:`${i.length} tendências encontradas e salvas!`})}catch(s){const a=`Falha ao buscar tendências: ${s instanceof Error?s.message:String(s)}`;N(a),o({type:"error",title:"Erro na Busca",message:a})}finally{I(!1)}},[l,n,G,o,y]),H=r.useCallback(async s=>{$(s.id);try{const a=y==="pt-BR"?`Com base no tópico em alta "${s.query}" e nos seguintes detalhes: "${s.data}", sugira uma ideia de conteúdo criativa e envolvente (por exemplo, um conceito de post para rede social ou título de blog). Mantenha a sugestão concisa e em português.`:`Based on the trending topic "${s.query}" and the following details: "${s.data}", suggest a creative and engaging content idea (e.g., a social media post concept or blog title). Keep it concise.`,i=await oe(a,{model:te});k(c=>({...c,[s.id]:i}))}catch(a){console.error("Error generating idea:",a),o({type:"error",title:"Erro",message:"Falha ao gerar ideia de conteúdo."})}finally{$(null)}},[o,y]),O=r.useCallback(s=>{f("ContentGenerator"),o({type:"info",message:`Criando conteúdo baseado na tendência: ${s.query}`})},[f,o]),Q=r.useCallback(s=>{f("SmartScheduler"),o({type:"info",message:`Adicionando tendência "${s.query}" ao calendário.`})},[f,o]),U=l.trim()||n.trim(),Z=r.useCallback(()=>{x(""),h(""),w([]),k({}),N(null)},[]),K=(s,a)=>{var B,F;if(!(a!=null&&a.groundingSupports)||!(a!=null&&a.groundingChunks)||a.groundingSupports.length===0)return e.jsx("p",{className:"text-body leading-relaxed whitespace-pre-wrap",children:s});const i=a.groundingSupports,c=a.groundingChunks;let j=s;const V=[...i].sort((d,g)=>{var u,t;return(((u=g.segment)==null?void 0:u.endIndex)??0)-(((t=d.segment)==null?void 0:t.endIndex)??0)});for(const d of V){const g=(B=d.segment)==null?void 0:B.endIndex;if(g===void 0||!((F=d.groundingChunkIndices)!=null&&F.length))continue;const u=d.groundingChunkIndices.map(t=>{var A,M,q,P;const v=((M=(A=c[t])==null?void 0:A.web)==null?void 0:M.uri)||((P=(q=c[t])==null?void 0:q.maps)==null?void 0:P.uri);return v?`[${t+1}](${v})`:null}).filter(Boolean);if(u.length>0){const t=" "+u.join("");j=j.slice(0,g)+t+j.slice(g)}}const z=j.split(/(\[\d+\]\(.+?\))/g);return e.jsx("p",{className:"text-body leading-relaxed whitespace-pre-wrap",children:z.map((d,g)=>{const u=d.match(/\[(\d+)\]\((.+?)\)/);if(u){const[,t,v]=u;return e.jsx("a",{href:v,target:"_blank",rel:"noopener noreferrer",className:"inline-block align-baseline text-xs bg-primary/10 text-primary font-bold px-1.5 py-0.5 rounded-md mx-0.5 hover:bg-primary/20 hover:underline",title:`Ir para fonte ${t}`,children:t},g)}return d})})};return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-title mb-8",children:"Caçador de Tendências"}),L&&e.jsxs("div",{className:"bg-red-900 border border-red-600 text-red-300 px-4 py-3 rounded relative mb-8",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Erro!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",L]})]}),e.jsxs("div",{className:"bg-surface p-6 rounded-xl shadow-card border border-gray-100 dark:border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-title mb-5 flex justify-between items-center",children:"Buscar Tendências"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(re,{id:"trendQuery",label:"Nicho ou Tópico:",value:l,onChange:s=>x(s.target.value),placeholder:"Ex: 'Marketing digital para restaurantes'",className:"mb-0"}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-title mb-1.5 flex justify-between",children:[e.jsx("span",{children:"Local (Opcional)"}),m==="success"&&!n&&e.jsxs("span",{className:"text-xs text-success flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"})," Usando GPS"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"trendCity",type:"text",className:`block w-full px-3 py-2.5 bg-surface border rounded-lg shadow-sm text-body placeholder-muted transition-colors focus:outline-none sm:text-sm ${m==="success"&&!n?"border-success/50 ring-1 ring-success/20 pl-9":"border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary"}`,value:n,onChange:s=>h(s.target.value),placeholder:m==="success"?"GPS Ativo (Digite para alterar)":"Digite cidade ou país..."}),m==="success"&&!n&&e.jsx(R,{className:"absolute left-3 top-2.5 w-4 h-4 text-success"}),e.jsx("button",{onClick:C,className:`absolute right-2 top-2 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${m==="success"?"text-success":"text-muted"}`,title:m==="success"?"GPS Ativo":"Ativar GPS",children:m==="pending"?e.jsx(se,{className:"w-4 h-4"}):e.jsx(R,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsx(p,{onClick:_,isLoading:T,variant:"primary",className:"w-full sm:w-auto",children:T?"Buscando Tendências...":"Buscar Tendências"}),U&&e.jsx(p,{onClick:Z,variant:"outline",className:"w-full sm:w-auto",children:"Limpar Busca"})]})]}),S.length>0&&e.jsxs("div",{className:"bg-surface p-6 rounded-xl shadow-card border border-gray-100 dark:border-gray-800",children:[e.jsx("h3",{className:"text-xl font-semibold text-title mb-5",children:"Resultados de Tendências"}),e.jsx("div",{className:"space-y-8",children:S.map(s=>e.jsxs("div",{className:"p-5 border border-gray-200 dark:border-gray-700 rounded-lg hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-title",children:s.query}),e.jsxs("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${s.score>70?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":s.score>40?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}`,children:["Score Viral: ",s.score]})]}),e.jsx("div",{className:"mb-4",children:K(s.data,s.groundingMetadata)}),s.sources&&s.sources.length>0&&e.jsxs("div",{className:"mt-3 bg-background/50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-muted mb-2",children:"Fontes:"}),e.jsx("ol",{className:"list-decimal list-inside text-sm text-primary space-y-1",children:s.sources.map((a,i)=>e.jsx("li",{children:e.jsx("a",{href:a.uri,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",children:a.title||a.uri})},i))})]}),E[s.id]&&e.jsxs("div",{className:"mt-4 mb-4 p-4 bg-primary/5 border border-primary/20 rounded-md animate-in fade-in",children:[e.jsxs("h5",{className:"text-sm font-bold text-primary mb-1 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Ideia de Conteúdo"]}),e.jsxs("p",{className:"text-sm text-body italic",children:['"',E[s.id],'"']})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-3 mt-6",children:[e.jsx(p,{onClick:()=>H(s),isLoading:W===s.id,variant:"outline",className:"w-full sm:w-auto",children:"Gerar Ideia de Conteúdo"}),e.jsx(p,{onClick:()=>O(s),variant:"primary",className:"w-full sm:w-auto",children:"Criar Conteúdo da Tendência"}),e.jsx(p,{onClick:()=>Q(s),variant:"secondary",className:"w-full sm:w-auto",children:"Adicionar ao Calendário"})]})]},s.id))})]})]})};export{he as default};
